---
title: "Screen Time Data Viz"
description: | 
  Draft ideas and example idioms
author:
  - first_name: "Taren"
    last_name: "Sanders"
    url: https://github.com/tarensanders
date: "`r Sys.Date()`"
repository_url: https://github.com/tarensanders/screen_viz
output: distill::distill_article
---

```{r setup, echo = FALSE}
knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  echo = FALSE
)
```

```{r load-data}
library(tidyverse)
library(patchwork)
df <- read_csv("https://raw.githubusercontent.com/Motivation-and-Behaviour/screen_umbrella/main/supplementary_files/Complete%20Effects%20Data.csv") # nolint
```

```{r tidy-data}
df <- df %>%
  mutate(
    plain_language_exposure =
      str_replace(plain_language_exposure, "Video game console", "Video games"),
    general_outcome = str_extract(plain_language_outcome, "[^:]+"),
    general_exposure = str_extract(plain_language_exposure, "[^:]+"),
    general_exposure =
      str_replace(general_exposure, "Screen use", "General screen use"),
    age_group_code = case_when(
      age_group == "All" ~ 0,
      age_group == "Young children" ~ 1,
      age_group == "Children" ~ 2,
      age_group == "Adolescents" ~ 3
    ),
    r = if_else(is.na(reanalysis_r), converted_r, reanalysis_r),
    r_lb = if_else(
      is.na(reanalysis_cilb_95), converted_cilb, reanalysis_cilb_95
    ),
    r_ub = if_else(
      is.na(reanalysis_ciub_95), converted_cilb, reanalysis_ciub_95
    ),
    n = if_else(
      is.na(reanalysis_n), original_n, reanalysis_n
    ),
    k = if_else(
      is.na(reanalysis_k), original_k, reanalysis_k
    )
  )
```

# Scenario One

> A parent wants to explore the types of exposure.
> The select a particular exposure (e.g., TV) might impact their child.
> They search for the exposure and are given an overview of the known outcome categories.
> Visualise info about the uncertainty for each effect.
> They filter the results for their child's age.
> They click into an outcome category to get more information on the result (e.g., text summary, info about reason for the uncertainty).


## Task One

> Explore the exposures that there are evidence for.

Not really sure how to do this one. I guess one option is a bar chart of the exposures by the number of outcomes associated (and vice-versa).

### Idea One

```{r, layout="l-page"}
df_exp <- df %>%
  distinct(general_exposure, plain_language_outcome) %>%
  group_by(general_exposure) %>%
  summarise(n = n()) %>%
  arrange(n) %>%
  ungroup() %>%
  mutate(
    id = row_number(),
    label_angle = 90 - 360 * (id - 0.5) / nrow(.),
    label_hjust = if_else(label_angle < -90, 1, 0),
    label_angle = if_else(label_angle < -90, label_angle + 180, label_angle)
  )

p1 <- ggplot(
  df_exp,
  aes(
    x = as.factor(id), y = n
  )
) +
  geom_bar(stat = "identity") +
  ylim(-100, 120) +
  labs(title = "Exposures") +
  theme_minimal(base_size = 5) +
  theme(
    legend.position = "none",
    axis.text = element_blank(),
    axis.title = element_blank(),
    panel.grid = element_blank(),
    # plot.margin = unit(rep(-1, 4), "cm")
  ) +
  coord_polar(start = 0) +
  geom_text(
    aes(
      x = id, y = n + 10,
      label = general_exposure, hjust = label_hjust,
      angle = label_angle
    )
  )

df_out <- df %>%
  distinct(general_outcome, plain_language_exposure) %>%
  group_by(general_outcome) %>%
  summarise(n = n()) %>%
  arrange(n) %>%
  ungroup() %>%
  mutate(
    id = row_number(),
    label_angle = 90 - 360 * (id - 0.5) / nrow(.),
    label_hjust = if_else(label_angle < -90, 1, 0),
    label_angle = if_else(label_angle < -90, label_angle + 180, label_angle)
  )

p2 <- ggplot(
  df_out,
  aes(
    x = as.factor(id), y = n
  )
) +
  geom_bar(stat = "identity") +
  ylim(-100, 120) +
  labs(title = "Outcomes") +
  theme_minimal(base_size = 5) +
  theme(
    legend.position = "none",
    axis.text = element_blank(),
    axis.title = element_blank(),
    panel.grid = element_blank(),
    # plot.margin = unit(rep(-1, 4), "cm")
  ) +
  coord_polar(start = 0) +
  geom_text(
    aes(
      x = id, y = n + 10,
      label = general_outcome, hjust = label_hjust,
      angle = label_angle
    )
  )

p1 + p2
```

### Notes

* I think it's OK not to have scales and things on how ever this one is shown.
The absolute values don't really matter.
* I don't really like this, very open to other ideas.

## Task Two

Explore an overview of the outcome categories for the selected exposure category.

(*E.g., if they have chosen 'video games'*)

### Idea One

Using length as the main idiom.

```{r, layout="l-page"}
df %>%
  filter(general_exposure == "Video games") %>%
  ggplot(aes(
    x = plain_language_outcome,
    y = r,
    ymin = r_lb,
    ymax = r_ub,
    fill = age_group,
    col = age_group
  )) +
  geom_linerange(position = position_dodge(width = 0.5), size = 3) +
  geom_point(
    size = 2, shape = 21,
    color = "white", stroke = 0.5, position = position_dodge(width = 0.5)
  ) +
  scale_y_continuous(name = "Correlation", limits = c(-0.8, 0.8)) +
  coord_flip() +
  theme_minimal(base_size = 5)
```

#### Notes

* Points are showing effects, line ranges are showing confidence intervals (so showing some aspects of uncertainty).
* There's still lots of information that this doesn't show (such as sample size or number of studies which are part of uncertainty)
* There's multiple points for some because there are sub-categories for 'video games' (e.g., violent video games, or educational), but it makes the plot a bit messy.
* There's some issues with a few of the data points that I'll resolve in the original dataset

### Idea Two

Using position as the main idiom.

```{r, layout="l-page", fig.height=6, fig.width=8}
p <- df %>%
  filter(general_exposure == "Video games") %>%
  ggplot(aes(
    y = log(n), x = r,
    color = general_outcome,
    text = plain_language_outcome
  )) +
  geom_point(size = 5) +
  theme_minimal()

plotly::ggplotly(p, tooltip = "text")
```
#### Notes

* Effect size indicated by horizontal position, but now missing uncertainty from the confidence intervals.
* Incorporates a different form of uncertainty (i.e., sample size) on the y-axis
* I guess it could incorporate other data through shape, but it looks a bit messy to message

<aside>
```{r}
df %>%
  filter(general_exposure == "Video games") %>%
  ggplot(aes(x = log(n), y = r, color = general_outcome, shape = age_group)) +
  geom_point(size = 10) +
  theme_minimal()
```
</aside>

## Task Three

Visualise the uncertainty for the selected exposure.

(*Not sure how to do this one*)

## Task Four

Filter the results by child's age

### Idea one

This is just the same as Task Two. E.g.,:

```{r, layout="l-page", fig.height=6, fig.width=8}
p <- df %>%
  filter(general_exposure == "Video games", age_group == "Children") %>%
  ggplot(aes(
    y = log(n), x = r,
    color = general_outcome,
    text = plain_language_outcome
  )) +
  geom_point(size = 5) +
  theme_minimal()

plotly::ggplotly(p, tooltip = "text")
```

## Task Five

Click into an otcome category to get additional information on the result.

(*Can't really do this is ggplot*)


# Scenario Two

> A domain expert wants to explore evidence for screen time in more detail.
> Use the system to get an overview of the evidence (exposure, outcome, effect size).
> They search for the exposure and/or the outcome, and optionally filter by age.
> They click into a relationship and can access the forest plot of the original studies, and the link to the original meta-analysis (and other, related studies, uncertainty). Three levels: evidence, uncertainty, meta-data.